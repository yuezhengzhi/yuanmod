libra_imperial_vermillion_land_army_node_effect = {
    every_owned_planet = {
        limit = {
            has_planet_flag = imperial_vermillion_node_general
        }
        remove_planet_flag = imperial_vermillion_node_general
    }
    every_owned_army = {
        limit = {
            exists = planet
            exists = leader
        }
        planet = { set_planet_flag = imperial_vermillion_node_general }
    }
    random_owned_army = {
        limit = {
            exists = planet
            planet = { not = { has_planet_flag = imperial_vermillion_node_general } }
            not = { exists = leader }
        }
        planet = { set_planet_flag = imperial_vermillion_node_general }
        root = {
            create_leader = {
                class = commander
                skill = 1
                immortal = yes
                hide_age = yes
                hide_leader = yes
                event_leader = yes
                randomize_traits = no
                can_assign_to_council = no
                can_manually_change_location = no
                species = owner_main_species
                name = libra_imperial_vermillion_node_name_a
            }
            #set_country_flag = libra_imperial_vermillion_node_created
            last_created_leader = {
                set_leader_flag = libra_extra_node_leader
                set_leader_flag = immune_to_negative_traits
                set_leader_flag = leader_death_events_blocked
                add_trait_no_notify = subclass_commander_general
                change_leader_portrait = councilor_gestalt_legion_1
            }
        }
        assign_leader = last_created_leader
    }
}

libra_imperial_vermillion_fleet_army_node_effect = {
    every_owned_fleet = {
        limit = {
            is_ship_class = shipclass_transport
            has_fleet_flag = imperial_vermillion_node_general
        }
        remove_fleet_flag = imperial_vermillion_node_general
    }
    every_owned_army = {
        limit = {
            exists = fleet
            exists = leader
        }
        fleet = { set_fleet_flag = imperial_vermillion_node_general }
    }
    random_owned_army = {
        limit = {
            exists = fleet
            fleet = { not = { has_fleet_flag = imperial_vermillion_node_general } }
            not = { exists = leader }
        }
        fleet = { set_fleet_flag = imperial_vermillion_node_general }
        root = {
            create_leader = {
                class = commander
                skill = 1
                immortal = yes
                hide_age = yes
                hide_leader = yes
                event_leader = yes
                randomize_traits = no
                can_assign_to_council = no
                can_manually_change_location = no
                species = owner_main_species
                name = libra_imperial_vermillion_node_name_a
            }
            #set_country_flag = libra_imperial_vermillion_node_created
            last_created_leader = {
                set_leader_flag = libra_extra_node_leader
                set_leader_flag = immune_to_negative_traits
                set_leader_flag = leader_death_events_blocked
                add_trait_no_notify = subclass_commander_general
                change_leader_portrait = councilor_gestalt_legion_1
            }
        }
        assign_leader = last_created_leader
    }
}

libra_imperial_vermillion_science_ship_node_effect = {
    random_owned_fleet = {
        limit = {
            is_ship_class = shipclass_science_ship
            not = { exists = leader }
        }
        root = {
            create_leader = {
                class = scientist
                skill = 1
                immortal = yes
                hide_age = yes
                hide_leader = yes
                event_leader = yes
                randomize_traits = no
                can_assign_to_council = no
                can_manually_change_location = no
                species = owner_main_species
                name = libra_imperial_vermillion_node_name_a
            }
            #set_country_flag = libra_imperial_vermillion_node_created
            last_created_leader = {
                set_leader_flag = libra_extra_node_leader
                set_leader_flag = immune_to_negative_traits
                set_leader_flag = leader_death_events_blocked
                random_list = {
                    1 = { add_trait_no_notify = subclass_scientist_explorer }
                    1 = { add_trait_no_notify = subclass_scientist_scholar }
                }
                change_leader_portrait = councilor_gestalt_cognitive_1
            }
        }
        assign_leader = last_created_leader
    }
}

libra_imperial_vermillion_military_ship_node_effect = {
    random_owned_fleet = {
        limit = {
            is_ship_class = shipclass_military
            not = { exists = leader }
        }
        root = {
            create_leader = {
                class = commander
                skill = 1
                immortal = yes
                hide_age = yes
                hide_leader = yes
                event_leader = yes
                randomize_traits = no
                can_assign_to_council = no
                can_manually_change_location = no
                species = owner_main_species
                name = libra_imperial_vermillion_node_name_a
            }
            #set_country_flag = libra_imperial_vermillion_node_created
            last_created_leader = {
                set_leader_flag = libra_extra_node_leader
                set_leader_flag = immune_to_negative_traits
                set_leader_flag = leader_death_events_blocked
                add_trait_no_notify = subclass_commander_admiral
                change_leader_portrait = councilor_gestalt_legion_1
            }
        }
        assign_leader = last_created_leader
    }
}

libra_imperial_vermillion_planet_node_effect = {
    random_owned_planet = {
        limit = {
            nor = {
                exists = leader
                uses_district_set = cosmogenesis_world
            }
            num_sapient_pops >= 1
        }
        if = {
            limit = {
                libra_has_research_designation = yes
            }
            root = {
                create_leader = {
                    class = scientist
                    skill = 1
                    immortal = yes
                    hide_age = yes
                    hide_leader = yes
                    event_leader = yes
                    randomize_traits = no
                    can_assign_to_council = no
                    can_manually_change_location = no
                    background_planet = prev
                    species = owner_main_species
                    name = libra_imperial_vermillion_node_name_b
                }
                last_created_leader = {
                    set_leader_flag = libra_extra_node_leader
                    set_leader_flag = immune_to_negative_traits
                    set_leader_flag = leader_death_events_blocked
                    add_trait_no_notify = subclass_scientist_governor
                    change_leader_portrait = councilor_gestalt_cognitive_1
                }
            }
        }
        else_if = {
            limit = {
                or = {
                    libra_has_generator_designation = yes
                    libra_has_farming_designation = yes
                    libra_has_mining_designation = yes
                    libra_has_rural_designation = yes
                    libra_has_fortress_designation = yes
                }
            }
            root = {
                create_leader = {
                    class = commander
                    skill = 1
                    immortal = yes
                    hide_age = yes
                    hide_leader = yes
                    event_leader = yes
                    randomize_traits = no
                    can_assign_to_council = no
                    can_manually_change_location = no
                    background_planet = prev
                    species = owner_main_species
                    name = libra_imperial_vermillion_node_name_b
                }
                last_created_leader = {
                    set_skill = owner.ruler.trigger:has_skill
                    set_leader_flag = libra_extra_node_leader
                    set_leader_flag = immune_to_negative_traits
                    set_leader_flag = leader_death_events_blocked
                    add_trait_no_notify = subclass_commander_governor
                    change_leader_portrait = councilor_gestalt_regulatory_1
                }
            }
        }
        else = {
            root = {
                create_leader = {
                    class = official
                    skill = 1
                    immortal = yes
                    hide_age = yes
                    hide_leader = yes
                    event_leader = yes
                    randomize_traits = no
                    can_assign_to_council = no
                    can_manually_change_location = no
                    background_planet = prev
                    species = owner_main_species
                    name = libra_imperial_vermillion_node_name_b
                }
                last_created_leader = {
                    set_skill = owner.ruler.trigger:has_skill
                    set_leader_flag = libra_extra_node_leader
                    set_leader_flag = immune_to_negative_traits
                    set_leader_flag = leader_death_events_blocked
                    add_trait_no_notify = subclass_official_governor
                    change_leader_portrait = councilor_gestalt_growth_1
                }
            }
        }
        assign_leader = last_created_leader
    }
}